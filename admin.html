<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DARK ADMIN | CONSOLE</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
    <style>
        :root {
            --bg-color: #05060f;
            --card-color: #0d0f1a;
            --neon-blue: #00d2ff;
            --danger: #ff4757;
        }

        body { font-family: 'Courier New', Courier, monospace; background-color: var(--bg-color); color: #fff; margin: 0; padding: 20px; }

        /* Stylized Cyber Text */
        .cyber-text { text-transform: uppercase; letter-spacing: 12px; font-weight: 900; color: var(--neon-blue); text-align: center; display: block; margin-bottom: 25px; }

        /* Sharp Neon Border Animation */
        .container {
            background: var(--card-color); padding: 30px; border-radius: 12px;
            width: 100%; max-width: 600px; margin: 40px auto; position: relative; z-index: 1; overflow: hidden;
        }
        .container::before {
            content: ''; position: absolute; top: -2px; left: -2px; right: -2px; bottom: -2px;
            background: conic-gradient(from 0deg, var(--neon-blue) 0%, transparent 40%, var(--neon-blue) 60%, transparent 100%);
            animation: rotate 4s linear infinite; z-index: -1; border-radius: 12px;
        }
        @keyframes rotate { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .container::after { content: ''; position: absolute; top: 1px; left: 1px; right: 1px; bottom: 1px; background: var(--card-color); border-radius: 11px; z-index: -1; }

        /* Inputs & Main Buttons */
        input[type="password"] { width: 100%; padding: 14px; margin-bottom: 20px; border: 1px solid #1e213a; border-radius: 6px; background: #000; color: #fff; text-align: center; letter-spacing: 5px; box-sizing: border-box; outline: none; }
        
        input[type="file"] { width: 100%; padding: 12px; margin: 20px 0; border: 1px dashed var(--neon-blue); border-radius: 6px; background: rgba(0,0,0,0.4); color: #555; cursor: pointer; }
        input[type="file"]::file-selector-button { background: transparent; color: var(--neon-blue); border: 1px solid var(--neon-blue); padding: 8px 20px; border-radius: 4px; cursor: pointer; margin-right: 15px; transition: 0.3s; }
        input[type="file"]::file-selector-button:hover { background: var(--neon-blue); color: #000; }

        button.action-btn { width: 100%; padding: 15px; background: transparent; border: 1px solid var(--neon-blue); border-radius: 6px; color: var(--neon-blue); font-weight: bold; cursor: pointer; text-transform: uppercase; transition: 0.3s; }
        button.action-btn:hover { background: var(--neon-blue); color: #000; }

        /* Asset Table Styles */
        .asset-item { display: flex; justify-content: space-between; align-items: center; padding: 15px; border-bottom: 1px solid #1e213a; transition: 0.3s; }
        .asset-item:hover { background: rgba(0, 210, 255, 0.03); }

        .control-btns { display: flex; gap: 10px; }
        .glass-btn { 
            background: rgba(255, 255, 255, 0.05); color: var(--neon-blue); border: 1px solid rgba(255, 255, 255, 0.1); 
            width: 38px; height: 38px; border-radius: 8px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: 0.3s;
        }
        .glass-btn.danger { color: var(--danger); border-color: rgba(255, 71, 87, 0.2); }
        .glass-btn:hover { background: rgba(255, 255, 255, 0.1); transform: translateY(-2px); }

        /* Translucent Modal System */
        #modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); backdrop-filter: blur(12px); display: none; align-items: center; justify-content: center; z-index: 9999; }
        .glass-modal { background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255,255,255,0.1); padding: 40px; border-radius: 24px; text-align: center; width: 320px; box-shadow: 0 10px 40px rgba(0,0,0,0.5); }
        .modal-btns { display: flex; justify-content: center; gap: 20px; margin-top: 25px; }
        .rect-btn { padding: 10px 30px; border: 1px solid var(--neon-blue); background: transparent; color: var(--neon-blue); border-radius: 4px; cursor: pointer; font-weight: bold; font-size: 11px; text-transform: uppercase; }
        .rect-btn.danger { border-color: var(--danger); color: var(--danger); }
        .rect-btn:hover { background: rgba(255,255,255,0.05); }
    </style>
</head>
<body>

    <script>
        const SB_URL = "https://zqvthmpazesxdjnjqwlb.supabase.co";
        const SB_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpxdnRobXBhemVzeGRqbmpxd2xiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk1NTExMzgsImV4cCI6MjA4NTEyNzEzOH0.-yPvu2wu7GW69LF7jxQMjiaB8XfVq0y2u903D56MjkM";
        const MASTER_PASS = "harry123";
        // Initialize client before any function calls
        const sbClient = window.supabase.createClient(SB_URL, SB_KEY);
    </script>

    <div id="modal-overlay">
        <div class="glass-modal">
            <h3 id="modal-title" style="color: var(--neon-blue); margin-top:0; letter-spacing: 3px;">SYSTEM</h3>
            <p id="modal-msg" style="font-size: 12px; opacity: 0.7; line-height: 1.6;"></p>
            <div id="modal-btns-container" class="modal-btns"></div>
        </div>
    </div>

    <div id="auth-box" class="container">
        <span class="cyber-text">DARK ADMIN</span>
        <input type="password" id="pass-input" placeholder="PASSKEY">
        <button class="action-btn" onclick="unlockConsole()">Enter</button>
    </div>

    <div id="main-box" class="container" style="display: none;">
        <span class="cyber-text">DARK FILE</span>
        <input type="file" id="file-input">
        <button id="up-btn" class="action-btn" onclick="handleUpload()">Upload</button>
        <div id="status" style="text-align: center; margin-top: 15px; font-weight: bold; font-size: 10px; color: var(--neon-blue);"></div>
    </div>

    <div id="list-box" class="container" style="display: none; max-width: 800px;">
        <span class="cyber-text" style="font-size: 14px; letter-spacing: 8px;">AVAILABLE FILES</span>
        <ul id="asset-list" style="list-style: none; padding: 0;"></ul>
    </div>

    <script>
        // --- MODAL SYSTEM LOGIC ---
        function showModal(title, msg, type, callback) {
            document.getElementById('modal-title').innerText = title;
            document.getElementById('modal-msg').innerText = msg;
            const container = document.getElementById('modal-btns-container');
            container.innerHTML = type === 'confirm' ? 
                `<button class="rect-btn" onclick="runCallback(${callback})">YES</button><button class="rect-btn danger" onclick="closeModal()">NO</button>` :
                `<button class="rect-btn" onclick="closeModal()">OK</button>`;
            document.getElementById('modal-overlay').style.display = 'flex';
        }
        function closeModal() { document.getElementById('modal-overlay').style.display = 'none'; }
        function runCallback(cb) { closeModal(); cb(); }

        // --- CORE LOGIC ---
        function unlockConsole() {
            const input = document.getElementById('pass-input').value;
            if(input === MASTER_PASS) {
                document.getElementById('auth-box').style.display = 'none';
                document.getElementById('main-box').style.display = 'block';
                document.getElementById('list-box').style.display = 'block';
                refreshFiles();
                // Real-time listener for auto-updates
                sbClient.channel('db').on('postgres_changes', { event: '*', schema: 'public', table: 'admin_files' }, () => refreshFiles()).subscribe();
            } else { showModal("ERROR", "Access Denied: Invalid Key.", "alert"); }
        }

        async function handleUpload() {
            const fileInput = document.getElementById('file-input');
            const file = fileInput.files[0];
            if(!file) return showModal("WARNING", "No asset selected.", "alert");
            
            const btn = document.getElementById('up-btn');
            btn.disabled = true; 
            document.getElementById('status').innerText = "UPLOADING..."; //

            const path = `files/${Date.now()}_${file.name}`; //
            try {
                // Upload to Supabase Storage
                const { data, error: stErr } = await sbClient.storage.from('my-scripts').upload(path, file);
                if(stErr) throw stErr;

                // Save Metadata to Database
                await sbClient.from('admin_files').insert([{
                    file_name: file.name, file_path: data.path, file_size: (file.size / 1024).toFixed(2) + " KB"
                }]);

                showModal("SUCCESS", "Asset secured in cloud cluster.", "alert");
                fileInput.value = ""; 
            } catch (err) { showModal("FAIL", err.message, "alert"); }
            finally { btn.disabled = false; document.getElementById('status').innerText = ""; }
        }

        async function refreshFiles() {
            const { data } = await sbClient.from('admin_files').select('*').order('uploaded_at', { ascending: false });
            const list = document.getElementById('asset-list');
            list.innerHTML = data && data.length > 0 ? "" : '<li style="text-align:center; color:#333; font-size:10px;">EMPTY_CLUSTER</li>';
            if(data) data.forEach(f => {
                const li = document.createElement('li');
                li.className = 'asset-item';
                li.innerHTML = `
                    <div><strong style="font-size:13px;">${f.file_name}</strong><br><small style="color:var(--neon-blue); font-size:9px;">${f.file_size}</small></div>
                    <div class="control-btns">
                        <button class="glass-btn" onclick="pullAsset('${f.file_path}', '${f.file_name}')"><i class="fas fa-download"></i></button>
                        <button class="glass-btn danger" onclick="confirmWipe('${f.id}', '${f.file_path}')"><i class="fas fa-trash-alt"></i></button>
                    </div>`;
                list.appendChild(li);
            });
        }

        // --- DOWNLOAD SYSTEM ---
        async function pullAsset(path, name) {
            // 
            const { data } = sbClient.storage.from('my-scripts').getPublicUrl(path);
            const link = document.createElement('a');
            link.href = data.publicUrl;
            link.setAttribute('download', name); // Force original filename
            link.setAttribute('target', '_blank');
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function confirmWipe(id, path) { showModal("CONFIRM", "Are you sure you want to terminate this asset?", "confirm", `() => wipeAsset('${id}', '${path}')`); }
        async function wipeAsset(id, path) {
            await sbClient.storage.from('my-scripts').remove([path]);
            await sbClient.from('admin_files').delete().eq('id', id);
            showModal("WIPED", "Asset removed from database.", "alert");
        }
    </script>
</body>
</html>