<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DARK FILES | PUBLIC ACCESS</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
    <style>
        :root {
            --bg-color: #000000;
            --hacker-green: #0f0;
            --glitch-red: #f00;
            --card-bg: rgba(0, 20, 0, 0.8);
        }

        body {
            margin: 0; padding: 20px; font-family: 'Share Tech Mono', monospace;
            background-color: var(--bg-color); color: var(--hacker-green); overflow-x: hidden;
        }

        /* --- HACKER BACKGROUND ANIMATION (Matrix Rain) --- */
        #matrix-canvas {
            position: fixed; top: 0; left: 0; z-index: -1; opacity: 0.8;
        }

        .container {
            max-width: 800px; margin: 0 auto; position: relative; z-index: 1;
        }

        /* --- GLITCH TITLE --- */
        .glitch-title {
            font-size: 4rem; text-align: center; font-weight: 900;
            text-transform: uppercase; letter-spacing: 5px; margin-bottom: 40px;
            position: relative; text-shadow: 2px 2px 0px var(--glitch-red);
            animation: glitch-pulse 2s infinite alternate;
        }
        @keyframes glitch-pulse {
            0% { text-shadow: 2px 2px 0px var(--glitch-red); opacity: 1; }
            50% { text-shadow: -2px -2px 0px var(--glitch-red), 2px 2px 5px var(--hacker-green); opacity: 0.8; }
            100% { text-shadow: 2px -2px 0px var(--glitch-red); opacity: 1; }
        }

        /* --- FILE LIST --- */
        .file-list { list-style: none; padding: 0; }
        .file-card {
            background: var(--card-bg); border: 1px solid var(--hacker-green);
            margin-bottom: 15px; padding: 15px 20px; border-radius: 4px;
            display: flex; justify-content: space-between; align-items: center;
            box-shadow: 0 0 10px rgba(0, 255, 0, 0.2); transition: 0.3s;
            position: relative; overflow: hidden;
        }
        .file-card::before {
            content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 2px;
            background: var(--hacker-green); animation: scanline 3s linear infinite;
        }
        @keyframes scanline { 0% { left: -100%; } 100% { left: 100%; } }
        
        .file-card:hover { box-shadow: 0 0 20px var(--hacker-green); transform: scale(1.01); }

        .file-info h3 { margin: 0; font-size: 1.2rem; letter-spacing: 1px; }
        .file-info p { margin: 5px 0 0; font-size: 0.8rem; opacity: 0.7; color: #8f8; }

        /* --- DOWNLOAD BUTTON --- */
        .download-btn {
            background: transparent; border: 1px solid var(--hacker-green);
            color: var(--hacker-green); padding: 10px 20px; font-family: 'Share Tech Mono', monospace;
            font-weight: bold; cursor: pointer; text-transform: uppercase;
            display: flex; align-items: center; gap: 10px; transition: 0.3s;
        }
        .download-btn:hover { background: var(--hacker-green); color: #000; box-shadow: 0 0 15px var(--hacker-green); }

        #loading-status { text-align: center; font-size: 1.2rem; margin-top: 50px; animation: blink 1s infinite; }
        @keyframes blink { 50% { opacity: 0; } }
    </style>
</head>
<body>

    <canvas id="matrix-canvas"></canvas>

    <div class="container">
        <h1 class="glitch-title">DARK FILES <br><span style="font-size: 1.5rem; letter-spacing: 2px;">// PUBLIC_ACCESS //</span></h1>
        
        <div id="loading-status">INITIALIZING CONNECTION...</div>
        <ul id="public-file-list" class="file-list"></ul>
    </div>

    <script>
        const SB_URL = "https://zqvthmpazesxdjnjqwlb.supabase.co";
        const SB_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpxdnRobXBhemVzeGRqbmpxd2xiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk1NTExMzgsImV4cCI6MjA4NTEyNzEzOH0.-yPvu2wu7GW69LF7jxQMjiaB8XfVq0y2u903D56MjkM";
        const sbClient = window.supabase.createClient(SB_URL, SB_KEY);
    </script>

    <script>
        // --- HACKER BACKGROUND ANIMATION SCRIPT ---
        const canvas = document.getElementById('matrix-canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth; canvas.height = window.innerHeight;
        const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789@#$%^&*()';
        const fontSize = 14; const columns = canvas.width / fontSize; const drops = Array(Math.floor(columns)).fill(1);
        function drawMatrix() {
            ctx.fillStyle = 'rgba(0, 0, 0, 0.05)'; ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = '#0f0'; ctx.font = fontSize + 'px monospace';
            for (let i = 0; i < drops.length; i++) {
                const text = chars.charAt(Math.floor(Math.random() * chars.length));
                ctx.fillText(text, i * fontSize, drops[i] * fontSize);
                if (drops[i] * fontSize > canvas.height && Math.random() > 0.975) drops[i] = 0;
                drops[i]++;
            }
        }
        setInterval(drawMatrix, 50);
        window.addEventListener('resize', () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; });


        // --- MAIN LOGIC: FETCH & DISPLAY FILES ---
        async function loadPublicFiles() {
            const status = document.getElementById('loading-status');
            // Fetch data using public policy
            const { data, error } = await sbClient.from('admin_files').select('*').order('uploaded_at', { ascending: false });
            
            if (error) { status.innerText = "SYSTEM ERROR: CONNECTION FAILED."; status.style.color = "red"; return; }
            
            const list = document.getElementById('public-file-list');
            list.innerHTML = "";
            status.style.display = "none";

            if (data && data.length > 0) {
                data.forEach(f => {
                    const li = document.createElement('li');
                    li.className = 'file-card';
                    li.innerHTML = `
                        <div class="file-info">
                            <h3>> ${f.file_name}</h3>
                            <p>SIZE: [ ${f.file_size} ]</p>
                        </div>
                        <button class="download-btn" onclick="publicDownload('${f.file_path}', '${f.file_name}')">
                            Download <i class="fas fa-file-download"></i>
                        </button>`;
                    list.appendChild(li);
                });
            } else {
                status.style.display = "block"; status.innerText = "NO DATA FOUND IN CLUSTER.";
            }
        }

        // --- DOWNLOAD LOGIC ---
        async function publicDownload(path, name) {
            // 
            const { data } = sbClient.storage.from('my-scripts').getPublicUrl(path);
            if(!data.publicUrl) return alert("Error: File not accessible.");
            
            const link = document.createElement('a');
            link.href = data.publicUrl;
            link.setAttribute('download', name);
            link.setAttribute('target', '_blank');
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Load files on page start
        loadPublicFiles();
    </script>
</body>
</html>